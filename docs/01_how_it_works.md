# 1. How it works.

buildenv's workspace would be like below, it consists of **buildenv.json**, **conf**, **downloads**, **installed**, **packages** and **script**.

```
├── buildenv.json
├── conf
│   ├── platforms
│   │   ├── aarch64-linux-jetson.json
│   │   ├── aarch64-linux-raspberry.json
│   │   ├── x86_64-linux-20.04.json
│   │   ├── x86_64-linux-22.04.json
│   │   └── x86_64-linux-native.json
│   ├── ports
│   │   ├── ffmpeg
│   │   ├── opencv
│   │   ├── x265
│   │   └── zlib
│   ├── projects
│   │   ├── project_001.json
│   │   ├── project_002.json
│   │   └── project_003.json
│   └── tools
│       ├── cmake-3.30.5-linux-x86_64.json
│       └── nasm-2.16.03.json
├── downloads
│   ├── cmake-3.30.5-linux-x86_64.tar.gz
│   ├── gcc-9.5.0.tar.gz
│   ├── nasm-2.16.03.tar.gz
│   ├── ubuntu-base-20.04.5-base-amd64.tar.gz
│   └── tools
│        ├── cmake-3.30.5-linux-x86_64
│        ├── gcc-9.5.0
│        ├── nasm-2.16.03
│        └── ubuntu-base-20.04.5-base-amd64
├── installed
│   ├── buildenv
│   │   └── info
│   │       ├── ffmpeg@n3.4.13-x86_64-linux-20.04-Release.list
│   │       ├── opencv@3.4.18-x86_64-linux-20.04-Release.list
│   │       ├── x264@stable-x86_64-linux-20.04-Release.list
│   │       ├── x265@4.0-x86_64-linux-20.04-Release.list
│   │       └── zlib@v1.3.1-x86_64-linux-20.04-Release.list
│   └── x86_64-linux-20.04-Release
│       ├── bin
│       ├── include
│       ├── lib
│       └── share
├── packages
│   ├── ffmpeg@n3.4.13-x86_64-linux-20.04-Release
│   │   ├── include
│   │   ├── lib
│   │   └── share
│   ├── opencv@3.4.18-x86_64-linux-20.04-Release
│   │   ├── bin
│   │   ├── include
│   │   ├── lib
│   │   └── share
│   ├── x264@stable-x86_64-linux-20.04-Release
│   │   ├── include
│   │   └── lib
│   └── x265@4.0-x86_64-linux-20.04-Release
│       ├── include
│       ├── lib
│       └── share
└─── scripts
    ├── environment
    └── toolchain_file.cmake
```

## 2. Introduction

- **buildenv.json**: This is buildenv's global config file, `conf repo`, `current platform`, `current project` and `cache_dirs` are defined in it, you can change it by buildenv's cli or text manually.

- **conf**: This should be a repo to save buildenv's configuration files. All available `platform`, `ports`, `projects` and `tools` are defined here.
    - **platform**: This folder contains all available platform configuration files. Each file defines the toolchain, rootfs, and tools.
    - **ports**: This folder contains all available third-party port configuration files. Each file defines the third party's repository URL, ref, version, and build step.
    - **projects**: This folder contains all available project configuration files. Each file defines third parties, CMake variables, environment variables, and compile options.
    - **tools**：This folder contains all available tool configuration files. Each file defines download url or local file url and its runtime dir.

- **downloads**:
Toolchain, rootfs, tools of different platforms would be download in this folder, and would be extracted to tools inside.
- **installed**: All thirdparty libraries would be built and installed into this folder, and stored in platform-specific subdirectories, such as `x86_64-linux-20.04-Release`.
- **packages**: This is a transitional directory for third-party library installation, and it is also the directory where third-party library cache packages are retrieved and extracted.
- **scripts**: In this folder there are two files always, `toolchian_file.cmake` and `environment`, they are all automaticall generated by selecting exact project config. `toolchian_file.cmake` is used to cross-compile your project, and `environment` is used to source in terminal, so that can build other third-party libraries which use uncommon build tools.

## 3. Work modes

buildenv provides two working mode: `cli menu` and `cli with argument`.

### 3.1 Command-Line menu.

```
./buildenv

Welcome to buildenv!                                   
Please choose an option from the menu below...         
                                                        
> 1. Init buildenv with conf repo.                      
2. Create a new platform.                             
3. Select your current platform.                      
4. Create a new project.                              
5. Select your current project.                       
6. Create a new tool.                                 
7. Create a new port.                                 
8. Integrate buildenv, then you can run it everywhere.
9. About and usage.                                   
                                                    
                                                        
↑/k up • ↓/j down • q quit • ? more
```

### 3.2 Execute command with parameters.

```
Usage of ./buildenv:
  -about
        about buildenv and how to use it.
  -build_type string
        set CMAKE_BUILD_TYPE, it works with other commands. (default "Release")
  -conf_repo_ref string
        set conf repo's ref, it's used with -init.
  -conf_repo_url string
        set conf repo's url, it's used with -init.
  -create_platform string
        create a new platform with template.
  -create_port string
        create a new port with template.
  -create_project string
        create a new project with template.
  -create_tool string
        create a new tool with template.
  -init
        init buildenv with config repo.
  -install string
        clone, configre, build and install a 3rd party port.
  -integrate
        integrate buildenv so can use it everywhere.
  -purge
        remove installed files after uninstall, it works with -uninstall.
  -recursive
        uninstall dependencies also, it works with -uninstall.
  -select_platform string
        select a platform as cross build environment.
  -select_project string
        select a project as current project.
  -silent
        run buildenv no output, it's used with -setup.
  -uninstall string
        uninstall a 3rd party port.
  -setup
        check and repair cross build envronment for selected platform.
```

## 4. Setup buildenv.

After executing `./buildenv -setup`, buildenv will do works as below:

- Check and repaire toolchain, rootfs and other tools for current selected platform. if missing, buildenv would download them and setup environment vars for them.
- Check if third-party libraies were installed for current selected project. if missing, buildenv would clone their source then configure, build and install, even their sub-depedencies.

>If factor, the command can automacally be executed by your project, while `cmake configure` your project.

## 5. About and usage.

```
Welcome to buildenv (v1.0.0).
---------------------------------------
This is a simple pkg-manager for C/C++.

1. How to use it to build cmake project: 
option1: set(CMAKE_TOOLCHAIN_FILE "/home/phil/buildenv/scripts/toolchain_file.cmake")
option2: cmake .. -DCMAKE_TOOLCHAIN_FILE=/home/phil/buildenv/scripts/toolchain_file.cmake

2. How to use it to build makefile project: 
source /home/phil/buildenv/scripts/environment

[ctrl+c/q -> quit]
```